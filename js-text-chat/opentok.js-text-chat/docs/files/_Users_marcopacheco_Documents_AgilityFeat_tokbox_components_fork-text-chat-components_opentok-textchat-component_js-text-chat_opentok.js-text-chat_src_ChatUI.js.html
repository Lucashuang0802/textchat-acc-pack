<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>/Users/marcopacheco/Documents/AgilityFeat/tokbox/components/fork-text-chat-components/opentok-textchat-component/js-text-chat/opentok.js-text-chat/src/ChatUI.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/ChatUI.html">ChatUI</a></li>
            
            </ul>

            

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: /Users/marcopacheco/Documents/AgilityFeat/tokbox/components/fork-text-chat-components/opentok-textchat-component/js-text-chat/opentok.js-text-chat/src/ChatUI.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
define([], function () {
  &#x27;use strict&#x27;;

  var uiLayout = [
    &#x27;&lt;div class=&quot;wms-widget-wrapper&quot;&gt;&#x27;,
      &#x27;&lt;div class=&quot;wms-widget-chat wms-widget-extras&quot; id=&quot;chatContainer&quot;&gt;&#x27;,
        &#x27;&lt;div class=&quot;wms-messages-header hidden&quot; id=&quot;chatHeader&quot;&gt;&#x27;,
          &#x27;&lt;span&gt;Chat with&lt;/span&gt;&#x27;,
        &#x27;&lt;/div&gt;&#x27;,
        &#x27;&lt;div id=&quot;wmsChatWrap&quot;&gt;&#x27;,
          &#x27;&lt;div class=&quot;wms-messages-holder&quot; id=&quot;messagesHolder&quot;&gt;&#x27;,
            &#x27;&lt;div class=&quot;wms-message-item wms-message-sent&quot;&gt;&#x27;,
            &#x27;&lt;/div&gt;&#x27;,
          &#x27;&lt;/div&gt;&#x27;,
          &#x27;&lt;div class=&quot;wms-send-message-box&quot;&gt;&#x27;,
            &#x27;&lt;input type=&quot;text&quot; maxlength=&quot;160&quot; class=&quot;wms-message-input&quot; placeholder=&quot;Enter your message here&quot; id=&quot;messageBox&quot;&gt;&#x27;,
            &#x27;&lt;button class=&quot;wms-icon-check&quot; id=&quot;sendMessage&quot; type=&quot;submit&quot;&gt;&lt;/button&gt;&#x27;,
            &#x27;&lt;div class=&quot;wms-character-count&quot;&gt;&lt;span&gt;&lt;span id=&quot;character-count&quot;&gt;0&lt;/span&gt;/160 characters&lt;/span&gt;&lt;/div&gt;&#x27;,
          &#x27;&lt;/div&gt;&#x27;,
        &#x27;&lt;/div&gt;&#x27;,
      &#x27;&lt;/div&gt;&#x27;,
    &#x27;&lt;/div&gt;&#x27;
  ].join(&#x27;\n&#x27;);

  var bubbleLayout = [
    &#x27;&lt;div&gt;&#x27;,
    &#x27;  &lt;header class=&quot;ot-bubble-header&quot;&gt;&#x27;,
    &#x27;    &lt;p class=&quot;ot-message-sender&quot;&gt;&lt;/p&gt;&#x27;,
    &#x27;    &lt;time class=&quot;ot-message-timestamp&quot;&gt;&lt;/time&gt;&#x27;,
    &#x27;  &lt;/header&gt;&#x27;,
    &#x27;&lt;/div&gt;&#x27;
  ].join(&#x27;\n&#x27;);

  var chatBubble = [
    &#x27;&lt;div class=&quot;&lt;%= message_class%&gt;&quot; &gt;&#x27;,
       &#x27;&lt;div class=&quot;wms-user-name-initial&quot;&gt;&lt;%= username[0] %&gt;&lt;/div&gt;&#x27;,
        &#x27;&lt;div class=&quot;wms-item-timestamp&quot;&gt;&lt;%= username%&gt;, &lt;span data-livestamp=&quot;&lt;%= time%&gt;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&#x27;,
        &#x27;&lt;div class=&quot;wms-item-text&quot;&gt;&#x27;,
            &#x27;&lt;span&gt;&lt;%= message%&gt;&lt;/span&gt;&#x27;,
        &#x27;&lt;/div&gt;&#x27;,
    &#x27;&lt;/div&gt;&#x27;
  ].join(&#x27;\n&#x27;);
  /**
   * User interface for a basic chat client.
   *
   * The UI display bubbles representing the chat activity in the conversation
   * area. An input area displays the remaining characters and allows to send
   * messages by hitting enter or clicking on the send button. To add a normal
   * break-line you can press the &#x60;shift + enter&#x60; combination.
   *
   * The conversation area groups messages separated no more than 2 minutes
   * (although this can be configured) and allow the user to review past
   * history even if receiving new messages.
   *
   * The chat UI can be placed inside any element by providing a &#x60;container&#x60;
   * and it will fill the container box.
   *
   * @class ChatUI
   * @constructor
   * @param {Object} [options] Hash with customizing properties.
   * @param {String} [options.container=&#x27;body&#x27;] CSS selector representing the
   * container for the chat.
   * @param {String} [options.senderId] Unique id for this client. It defaults
   * in a random number.
   * @param {String} [options.senderAlias=&#x27;me&#x27;] Alias to be displayed for this
   * client.
   * @param {Number} [options.maxTextLength=1000] Maximum length of the message.
   * @param {Number} [options.groupDelay=120000] Time in milliseconds to be
   * passed for the UI to separate the messages in different bubbles.
   * @param {Number} [options.timeout=5000] Time in milliseconds before
   * informing about a malfunction while sending the message.
   */
  function ChatUI(options) {
    options = options || {};
    this.senderId = options.senderId || (&#x27;&#x27; + Math.random()).substr(2);
    this.senderAlias = options.senderAlias || &#x27;me&#x27;;
    this.maxTextLength = options.maxTextLength || 1000;
    this.groupDelay = options.groupDelay || 2 * 60 * 1000;
    // 2 min
    this.timeout = options.timeout || 5000;
    this._watchScrollAtTheBottom = this._watchScrollAtTheBottom.bind(this);
    this._messages = [];
    this._setupTemplates();
    this._setupUI(options.text_chat_widget_holder);
    this._imCharacterCount = options.comms_elements.imCharacterCount;
    // this._updateCharCounter();
    this._widget = options.widget;
  }
  ChatUI.prototype = {
    constructor: ChatUI,
    _setupTemplates: function () {
    },
    getBubbleHtml: function(message){
      var bubble = 
        [
          &#x27;&lt;div class=&quot;&#x27;+ message.message_class +&#x27;&quot; &gt;&#x27;,
            &#x27;&lt;div class=&quot;wms-user-name-initial&quot;&gt; &#x27;+message.username[0] +&#x27;&lt;/div&gt;&#x27;,
            &#x27;&lt;div class=&quot;wms-item-timestamp&quot;&gt; &#x27;+message.username+&#x27;, &lt;span data-livestamp=&quot; &#x27;+message.time+&#x27;&quot; &lt;/span&gt;&lt;/div&gt;&#x27;,
            &#x27;&lt;div class=&quot;wms-item-text&quot;&gt;&#x27;,
              &#x27;&lt;span&gt; &#x27;+message.message +&#x27;&lt;/span&gt;&#x27;,
            &#x27;&lt;/div&gt;&#x27;,
          &#x27;&lt;/div&gt;&#x27;].join(&#x27;\n&#x27;);
        return bubble;
    },
    addMessageToBeDelivered: function(){
      var message = 
        [
          &#x27;&lt;div class=&quot;wms-messages-alert&quot;&gt;&#x27;,
            &#x27;&lt;span&gt;Your message will be delivered once your contact has arrived.&lt;/span&gt;&#x27;,
          &#x27;&lt;/div&gt;&#x27;].join(&#x27;\n&#x27;);
      $(&quot;#messagesHolder&quot;).append(message);
    },
    removeAlertMessage: function(){ 
      $(&quot;.wms-messages-alert&quot;).html(&quot;&lt;span&gt;Your messages have been delivered.&lt;/span&gt;&quot;).delay(5000).fadeOut(&#x27;slow&#x27;);
    },
    _setupUI: function (parent) {
      parent = document.querySelector(parent) || document.body;
      var chatView = document.createElement(&#x27;section&#x27;);
      chatView.innerHTML = uiLayout;
      var sendButton = chatView.querySelector(&#x27;#sendMessage&#x27;);
      var composer = chatView.querySelector(&#x27;#messageBox&#x27;);
      var charCounter = chatView.querySelector(&#x27;#wms-character-count &gt; span&#x27;);
      var newMessages = chatView.querySelector(&#x27;#messagesHolder&#x27;);
      this._composer = composer;
      this._sendButton = sendButton;
      this._charCounter = charCounter;
      this._bubbles = chatView.firstElementChild;
      this._newMessages = newMessages;
      this._bubbles.onscroll = this._watchScrollAtTheBottom;
      this._sendButton.onclick = this._sendMessage.bind(this);
      this._composer.onkeyup = this._updateCharCounter.bind(this);
      this._composer.onkeydown = this._controlComposerInput.bind(this);
      parent.appendChild(chatView);
      //document.write(&#x27;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;../css/widget.css&quot;&gt;&#x27;);
    },
    _watchScrollAtTheBottom: function () {
      if (this._isAtBottom()) {
        this._hideNewMessageAlert();
      }
    },
    _sendMessage: function () {
      var _this = this;
      console.log(&quot;opentok_text_chat sendMessage&quot;);
      console.log(this._widget);
      this._widget._sendTxtMessage(this._composer.value);
    },
    _cleanComposer: function(){
      this._composer.value = &#x27;&#x27;;
      $(this._imCharacterCount).text(&quot;0&quot;);
    },
    onIncomingMessage: function(event) {},
    _controlComposerInput: function (evt) {
      var isEnter = evt.which === 13 || evt.keyCode === 13;
      if (!evt.shiftKey &amp;&amp; isEnter) {
        evt.preventDefault();
        this._sendMessage();
      }
    },
    _updateCharCounter: function () {
      $(this._imCharacterCount).text(this._composer.value.length);
    }
  };
  return ChatUI;
});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
